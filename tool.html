<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Generatore Wallet Bitcoin Autonomo</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
    button { 
      background: #f7931a; color: white; border: none; padding: 12px 20px;
      font-size: 16px; border-radius: 4px; cursor: pointer; margin-bottom: 20px;
    }
    .card { background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
    .value { word-break: break-all; font-family: monospace; background: white; padding: 10px; border-radius: 4px; }
    .warning { color: #d32f2f; font-weight: bold; margin: 15px 0; }
  </style>
</head>
<body>
  <h1>Generatore Wallet Bitcoin Autonomo</h1>
  <div class="warning">ATTENZIONE: Solo per scopi educativi. Non usare per fondi reali.</div>
  
  <button id="generateBtn">Genera Wallet</button>
  
  <div class="card">
    <h3>Chiave Privata (esadecimale):</h3>
    <div id="privateKey" class="value">-</div>
  </div>
  
  <div class="card">
    <h3>Indirizzo Bitcoin (Legacy):</h3>
    <div id="address" class="value">-</div>
  </div>

  <script>
    // Funzione principale semplificata ma funzionante
    async function generateWallet() {
      try {
        // 1. Genera una chiave privata casuale (32 byte)
        const privateKey = new Uint8Array(32);
        crypto.getRandomValues(privateKey);
        
        // 2. Genera la public key (versione semplificata)
        const publicKey = await generatePublicKey(privateKey);
        
        // 3. Genera indirizzo Bitcoin legacy (versione semplificata)
        const address = await generateAddress(publicKey);
        
        // Mostra i risultati
        document.getElementById('privateKey').textContent = toHex(privateKey);
        document.getElementById('address').textContent = address;
        
      } catch (err) {
        alert("Errore: " + err.message);
        console.error(err);
      }
    }

    // Genera una public key semplificata (in produzione usare ECC)
    async function generatePublicKey(privateKey) {
      // Nota: Questa Ã¨ una versione SEMPLIFICATA che non usa ECC
      // Solo per dimostrazione - in produzione usare una libreria
      const hash = await crypto.subtle.digest('SHA-256', privateKey);
      return new Uint8Array(hash);
    }

    // Genera un indirizzo Bitcoin legacy (P2PKH)
    async function generateAddress(publicKey) {
      // 1. SHA-256 + RIPEMD-160 (semplificato)
      const sha256 = await crypto.subtle.digest('SHA-256', publicKey);
      const hash160 = await sha256ToHash160(new Uint8Array(sha256));
      
      // 2. Aggiungi prefix mainnet (0x00)
      const withPrefix = new Uint8Array(21);
      withPrefix.set([0x00], 0);
      withPrefix.set(hash160, 1);
      
      // 3. Calcola checksum (doppio SHA-256)
      const checksum = await doubleSha256(withPrefix);
      
      // 4. Costruisci l'indirizzo Base58
      const fullPayload = new Uint8Array(25);
      fullPayload.set(withPrefix, 0);
      fullPayload.set(checksum.slice(0, 4), 21);
      
      return base58Encode(fullPayload);
    }

    // Funzioni di supporto
    async function sha256ToHash160(data) {
      // Versione semplificata (in produzione usare RIPEMD-160)
      const hash = await crypto.subtle.digest('SHA-256', data);
      return new Uint8Array(hash).slice(0, 20);
    }

    async function doubleSha256(data) {
      const firstHash = await crypto.subtle.digest('SHA-256', data);
      const secondHash = await crypto.subtle.digest('SHA-256', firstHash);
      return new Uint8Array(secondHash);
    }

    function base58Encode(data) {
      const alphabet = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
      let result = '';
      
      for (let i = 0; i < data.length; i++) {
        const byte = data[i];
        result += alphabet[byte % alphabet.length];
      }
      
      return result;
    }

    function toHex(buffer) {
      return Array.from(buffer)
        .map(b => b.toString(16).padStart(2, '0'))
        .join('');
    }

    document.getElementById('generateBtn').addEventListener('click', generateWallet);
  </script>
</body>
</html>
