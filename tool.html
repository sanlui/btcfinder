<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BTC Finder - Wallet Generator</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="./css/styles.css">
  
  <!-- Librerie ESSENZIALI con fallback -->
  <script>
    function loadScript(src, integrity, onError) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        if(integrity) script.integrity = integrity;
        script.crossOrigin = 'anonymous';
        script.onload = resolve;
        script.onerror = () => {
          console.error(`Failed to load ${src}`);
          if(onError) onError();
          reject();
        };
        document.head.appendChild(script);
      });
    }

    // Caricamento librerie con fallback
    Promise.all([
      loadScript('https://cdnjs.cloudflare.com/ajax/libs/bip39/3.0.4/bip39.min.js', 
                'sha512-hxS0JnJ5shQJfT6+LJOD0nLQOvZS8g8Sw2NKxSIXJuTZv3ZqY4dMnkRNT7nZQpQ1Y7NWKT0X5z9Rpt/hQdZ9A==',
                () => loadScript('./js/bip39.min.js')),
      
      loadScript('https://cdnjs.cloudflare.com/ajax/libs/bitcoinjs-lib/6.1.0/bitcoinjs-lib.min.js',
                'sha512-YFkGZzA9j8wnj7PpZEmg0wvWbO6x8JdQq7ZQp1+E0rQ5Q9TUJ0q0QxjoZQq7TIRV0X+ZtW7L7P5jGZk6CjjUQg==',
                () => loadScript('./js/bitcoinjs-lib.min.js')),
      
      loadScript('https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js',
                '',
                () => loadScript('./js/qrcode.min.js'))
    ]).catch(e => {
      console.error("Errore critico: Impossibile caricare le librerie necessarie", e);
      alert("Errore nel caricamento delle risorse necessarie. Ricarica la pagina o contatta il supporto.");
    });
  </script>
</head>
<body>
  <!-- Resto del tuo HTML rimane identico -->
  <!-- ... -->

  <script>
    // Verifica avanzata delle librerie
    function checkLibs() {
      const libsLoaded = {
        bip39: typeof bip39 !== 'undefined',
        bitcoin: typeof bitcoin !== 'undefined',
        QRCode: typeof QRCode !== 'undefined'
      };
      
      if(!libsLoaded.bip39 || !libsLoaded.bitcoin) {
        const errorMsg = `Librerie mancanti:
          - bip39: ${libsLoaded.bip39 ? '✅' : '❌'}
          - bitcoinjs-lib: ${libsLoaded.bitcoin ? '✅' : '❌'}
          - QRCode: ${libsLoaded.QRCode ? '✅' : '❌'}
          
          Ricarica la pagina (CTRL+F5) o usa un browser moderno.`;
        
        console.error(errorMsg);
        alert(errorMsg);
        return false;
      }
      
      console.log("Tutte le librerie caricate correttamente!");
      return true;
    }

    // Attendi il caricamento completo della pagina
    window.addEventListener('load', function() {
      if(checkLibs()) {
        // Test rapido di funzionalità
        try {
          const testMnemonic = bip39.generateMnemonic();
          console.log("Test mnemonico generato:", testMnemonic);
        } catch(e) {
          console.error("Errore nel test iniziale:", e);
        }
      }
    });
  </script>

  <!-- Script JS -->
  <script src="./js/app.js"></script>
</body>
</html>
