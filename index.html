<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bitcoin Paper Wallet Generator</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: auto;
      font-family: 'Courier New', monospace;
      background: #000;
      color: #fff;
    }
    #bg-video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }
    .wallet-container {
      position: relative;
      max-width: 800px;
      margin: 40px auto;
      background: rgba(255,255,255,0.9);
      color: #000;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      border-radius: 8px;
    }
    h1, h2, h3 { color: #333; }
    p { color: #333; }
    #canvas {
      background: white;
      border: 1px solid #ccc;
      margin: 20px auto;
      cursor: pointer;
    }
    .no-print { margin-top: 20px; }
    .print-only { display: none; }
    @media print {
      .no-print { display: none; }
      .print-only { display: block; }
      body { background: none; }
      .wallet-container {
        background: none;
        box-shadow: none;
        padding: 0;
      }
    }
    .tab {
      overflow: hidden;
      border: 1px solid #ccc;
      background: #f1f1f1;
      margin-bottom: 20px;
    }
    .tab button {
      background: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 16px;
      transition: background 0.3s;
    }
    .tab button:hover { background: #ddd; }
    .tab button.active {
      background: #f7931a;
      color: white;
    }
    .tabcontent {
      display: none;
      padding: 20px;
      border: 1px solid #ccc;
      border-top: none;
    }
  </style>
</head>
<body>

  <!-- Background video -->
  <video id="bg-video" autoplay muted loop>
    <source src="videos/video.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <div class="wallet-container">
    <h1>Bitcoin Paper Wallet Generator</h1>
    <p>Move your mouse or type in the box to generate entropy.</p>

    <div class="tab">
      <button class="tablinks active" onclick="openTab(event,'Single')">Single Wallet</button>
      <button class="tablinks" onclick="openTab(event,'Bulk')">Bulk Generation</button>
    </div>

    <!-- Single wallet -->
    <div id="Single" class="tabcontent" style="display: block;">
      <canvas id="canvas" width="600" height="300"></canvas>
      <div id="addressDisplay"></div>
      <div id="privkeyDisplay"></div>
      <button onclick="printWallet()" class="no-print">Print Wallet</button>
      <div class="print-only">
        <h2>BITCOIN PAPER WALLET</h2>
        <p>Scan the QR code to access funds</p>
        <div id="printArea"></div>
      </div>
    </div>

    <!-- Bulk wallet -->
    <div id="Bulk" class="tabcontent">
      <p>How many wallets would you like to generate? (Max 20)</p>
      <input type="number" id="walletCount" min="1" max="20" value="5">
      <button onclick="generateBulkWallets()">Generate</button>
      <div id="bulkWallets"></div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/tiny-secp256k1@2.2.1/dist/tiny-secp256k1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ecpair@2.0.1/dist/ecpair.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@5.2.0/dist/bitcoinjs-min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

  <script>
    // --- Initialization ---
    let entropy = '';
    let walletGenerated = false;
    const ecc = tinysecp;
    ECPair.inject(ecc);

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const addressDisplay = document.getElementById('addressDisplay');
    const privkeyDisplay = document.getElementById('privkeyDisplay');
    const printArea = document.getElementById('printArea');

    // Draw random dots until entropy arrives
    function drawRandomPattern() {
      if (walletGenerated) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < 60; i++) {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height;
        const r = Math.random() * 5;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, 2 * Math.PI);
        ctx.fillStyle = `rgba(${rand255()},${rand255()},${rand255()},0.6)`;
        ctx.fill();
      }
      requestAnimationFrame(drawRandomPattern);
    }

    function rand255() {
      return Math.floor(Math.random() * 256);
    }

    // Collect entropy from mouse and keyboard
    function collectEntropy(evt) {
      if (walletGenerated) return;
      const time = Date.now();
      if (evt.type === 'mousemove') {
        entropy += `${evt.clientX},${evt.clientY},${time}|`;
      } else {
        entropy += `${evt.key || evt.code},${time}|`;
      }
      if (entropy.length > 600) {
        generateWallet();
      }
    }

    // Generate a single wallet
    function generateWallet() {
      walletGenerated = true;
      window.onbeforeunload = null; // allow navigation
      const hash = bitcoin.crypto.sha256(Buffer.from(entropy));
      const keyPair = ECPair.fromPrivateKey(hash, { network: bitcoin.networks.bitcoin });
      const wif = keyPair.toWIF();
      const { address } = bitcoin.payments.p2pkh({ pubkey: keyPair.publicKey, network: bitcoin.networks.bitcoin });
      displayWallet(address, wif);
    }

    // Display public & private QR codes
    function displayWallet(address, wif) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      QRCode.toCanvas(canvas, address, { width: 120, margin: 2 }, err1 => {
        if (err1) console.error(err1);
        ctx.fillStyle = '#000';
        ctx.font = '14px Arial';
        ctx.fillText('Public Address', 150, 30);
        ctx.font = '10px Arial';
        ctx.fillText(address, 150, 50);

        const privCanvas = document.createElement('canvas');
        QRCode.toCanvas(privCanvas, wif, { width: 120, margin: 2 }, err2 => {
          if (err2) console.error(err2);
          ctx.drawImage(privCanvas, 0, 150);
          ctx.fillStyle = '#000';
          ctx.font = '14px Arial';
          ctx.fillText('Private Key (WIF)', 150, 180);
          ctx.font = '10px Arial';
          ctx.fillText(wif, 150, 200);

          setupPrintArea(address, wif);
        });
      });
    }

    function setupPrintArea(address, wif) {
      printArea.innerHTML = `
        <div style="text-align:center;margin-bottom:30px;">
          <h3>Public Address</h3>
          <canvas id="printPubQR" width="200" height="200"></canvas>
          <p>${address}</p>
        </div>
        <div style="text-align:center;">
          <h3>Private Key</h3>
          <canvas id="printPrivQR" width="200" height="200"></canvas>
          <p>${wif}</p>
        </div>`;
      QRCode.toCanvas(document.getElementById('printPubQR'), address, { width: 200 });
      QRCode.toCanvas(document.getElementById('printPrivQR'), wif, { width: 200 });
    }

    // Bulk generation
    function generateBulkWallets() {
      const count = Math.min(Math.max(parseInt(document.getElementById('walletCount').value) || 1, 1), 20);
      let html = '';
      for (let i = 0; i < count; i++) {
        const seed = entropy + i + Date.now();
        const hash = bitcoin.crypto.sha256(Buffer.from(seed));
        const keyPair = ECPair.fromPrivateKey(hash, { network: bitcoin.networks.bitcoin });
        const wif = keyPair.toWIF();
        const { address } = bitcoin.payments.p2pkh({ pubkey: keyPair.publicKey, network: bitcoin.networks.bitcoin });
        html += `
          <div class="wallet" style="border:1px solid #ccc; padding:10px; margin:10px 0; color:#000; background:#fff;">
            <h3>Wallet ${i + 1}</h3>
            <p><strong>Address:</strong> ${address}</p>
            <p><strong>Private Key:</strong> ${wif}</p>
          </div>`;
      }
      document.getElementById('bulkWallets').innerHTML = html;
    }

    function printWallet() { window.print(); }

    function openTab(evt, tabName) {
      document.querySelectorAll('.tabcontent').forEach(c => c.style.display = 'none');
      document.querySelectorAll('.tablinks').forEach(b => b.classList.remove('active'));
      document.getElementById(tabName).style.display = 'block';
      evt.currentTarget.classList.add('active');
    }

    window.onbeforeunload = function() {
      if (!walletGenerated && entropy.length > 100) {
        return 'Wallet not yet generated. Are you sure you want to leave?';
      }
    };

    canvas.addEventListener('mousemove', collectEntropy);
    document.addEventListener('keydown', collectEntropy);

    drawRandomPattern();
  </script>
</body>
</html>
