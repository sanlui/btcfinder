<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test Generatore Wallet BTC</title>
  <style>
    body { background: #121212; color: white; font-family: Arial; text-align: center; padding: 50px; }
    button { font-size: 1.2rem; padding: 10px 20px; margin-bottom: 20px; cursor: pointer; }
    .card { background: #222; padding: 20px; max-width: 600px; margin: 0 auto; border-radius: 8px; text-align: left; }
    .label { font-weight: bold; color: #0d6efd; }
    .value { color: #ffc107; word-break: break-word; }
    .balance { color: #198754; font-weight: bold; }
  </style>
</head>
<body>

<h1>Generatore Wallet Bitcoin</h1>
<button id="genBtn">Genera Wallet</button>

<div class="card">
  <p><span class="label">Indirizzo:</span> <span id="address" class="value">–</span></p>
  <p><span class="label">Chiave Privata (WIF):</span> <span id="privateKey" class="value">–</span></p>
  <p><span class="label">Saldo:</span> <span id="balance" class="balance">–</span></p>
</div>

<!-- Libreria bitcoinjs-lib -->
<script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@6.1.0/dist/bitcoinjs-lib.min.js"></script>

<script>
  document.getElementById('genBtn').addEventListener('click', async () => {
    try {
      // Genera la coppia chiave
      const keyPair = bitcoin.ECPair.makeRandom();
      // Genera indirizzo legacy P2PKH
      const { address } = bitcoin.payments.p2pkh({ pubkey: keyPair.publicKey });
      // Chiave privata in formato WIF
      const privateKeyWIF = keyPair.toWIF();

      // Mostra i dati nel DOM
      document.getElementById('address').textContent = address;
      document.getElementById('privateKey').textContent = privateKeyWIF;
      document.getElementById('balance').textContent = 'Caricamento...';

      // Fetch saldo da Blockstream API
      const res = await fetch(`https://blockstream.info/api/address/${address}`);
      if (!res.ok) throw new Error('Errore caricamento saldo');
      const data = await res.json();

      // Calcola saldo BTC (in BTC, non in satoshi)
      const bal = (data.chain_stats.funded_txo_sum - data.chain_stats.spent_txo_sum) / 1e8;
      document.getElementById('balance').textContent = bal + ' BTC';
    } catch (error) {
      console.error(error);
      alert('Errore: guarda la console per dettagli');
      document.getElementById('balance').textContent = 'Errore';
    }
  });
</script>

</body>
</html>
